<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Mesocosmico Recipe Maker</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.3.0/snap.svg-min.js"> </script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
	<link rel="stylesheet" href="countries.css">
	<!-- <link rel="stylesheet" href="http://45.55.165.85:3000/countries.css"> -->
	<style>
		@import url(http://fonts.googleapis.com/css?family=Hind:400,700);
		svg{
			/*width:1440px;*/
			/*height:1000px;	*/
			background-color :red;
			color:blue;
		}
		.object	{
			fill: blue;
		}

		.canvas{
			background-color :red;
			color:blue;
		}
		.text{
			fill:RGBA(199, 104, 202, 1);
			font-family: 'Hind', sans-serif;
			font-size:170px;
		}
	</style>

	<script src="mmFactory.js"></script>
	<script>
		var params = {
			"icon_viewbox" : "0 0 128 128",
			"w" : 1440,
			"h" : 1000,
			"class":"canvas",
		}
		
		var text;
		var defaultViewBox ="0 0 128 128";
		var wid
		var categories = {};
		var icons_data;
		var hs_map = {};

		var icons = {};
		var left,right;
		var s,scope; 
		
		
		$( document ).ready(function(){
			// var svg = Snap("#svg");	
			// svg.addClass("canvas");
			 var w = $(window).width();
			 var h = $(window).height();

			 // var w = 1920;
			 // var h = 768;

			 // $('#svg').css('width', w/2);
			 $('#svg').css('width', w);
			 $('#svg').css('height', h);

			 // $('#svgother').css('width', w/2);
			 // $('#svgother').css('height', h);

			 $.ajax({
				type: "GET",
				url: "/icons",
				})
				.done(function(data) {
					$.ajax({type:'GET',url:'hs_possible_src_for_dst.json' }).done(function(data1){
						console.log(data,data1);
						hs_map = data1;
						left = mmFactory(data,"#svg");
						// right = mmFactory(data,"#svgother")
						// updateSvg("fra","usa",left);	
						// updateSvgTagged("Mexico",left)						
					})

					
					});
				// })
			});



		$(window).bind( 'hashchange', function(e) { 
	    	var anchor = document.location.hash;
	            params = anchor.toLowerCase().replace("#","").split('-')
				var options = hs_map[params[0]];
	            for(i in options){
	            	if(options[i].dst === params[1] ){
	            		console.log(options[i]);
	            		var index = getRandomInt(0,options[i]['possible_srcs'].length);
	            		console.log(options[i]['possible_srcs'][index]);
	            		updateSvg(params[1],options[i]['possible_srcs'][index],left);
	            		$('#src').empty()
	            		$('#src').append('Random source: '+options[i]['possible_srcs'][index]);

	            	}
	            }
				// updateSvg(countries[0],countries[1],left);
				// $('#names').empty();
				// $('#names').append("Source: "+countries[0].toUpperCase()+" Destination : "+countries[1].toUpperCase());
    	});


		function updateSvgTagged(country,pMaker){
			var request = $.ajax({
					type: "POST",
					url: "/country",
					data:JSON.stringify({"country":country}),
					dataType: 'JSON',
					contentType: 'application/json' 
				})
				.done(function(data) {
					if(data == "Bogus"){
						$('#names').empty()
						$('#names').append("didnt work. try again");
					}
					else{
						var ids = data;
						console.log(ids);
						pMaker.LoadHSData(ids);	
					}
					
				})
				.fail(function() {
					console.log( "error" );
					$('#names').empty()
					$('#names').append("didnt work. try again");
				})
		}

		function updateSvg(src,dst,pMaker){
			var request = $.ajax({
					type: "POST",
					url: "/gettradeicons",
					data:JSON.stringify({"src":src,"dst":dst}),
					dataType: 'JSON',
					contentType: 'application/json' 
				})
				.done(function(data) {
					if(data == "Bogus"){
						$('#names').empty()
						$('#names').append("didnt work. try again");
					}
					else{
						console.log(data);
						var ids = JSON.parse(data);
						pMaker.LoadHSData(ids,src,dst);	
					}
					
				})
				.fail(function() {
					console.log( "error" );
					$('#names').empty()
					$('#names').append("didnt work. try again");
				})

		}
		function getRandomInt(min, max) {
		  return Math.floor(Math.random() * (max - min)) + min;
		}
	</script>
</head>


<body>
<!-- <p style="text-align:center;">
The More&More textile maker exemplifies the kind of output that we are generating using the More&More dataset. These textiles represent the import and export relationships of two selected countries (list links here for a few different country relationships). The text in the background is from the harmonized system code of categorization for the products exchanged, and in the foreground are iconic representations of some of those products. The background gradients are extrapolated from the colors of flags of their countries of origin. These textiles will eventually be used to make swimsuits, as a nod to the important role of the sea in global shipping. 
 </p>
 <p> -->
 <h2>Icons </h2>
<p>6404,1201,8904,8802,9706,8703,9003,3926,4301,2710,9006,1605,9302,6109,6704,0105,7102,3003,0804,4403,4011,8517,9201,9021,7018,7108,7002,8471,3923,9306,
 </p>
 <h2>Countries </h2>
 <p>bra,usa,rus,mex,ind,chn,jpn,tur</p>
 <h2 id='src'> </h2>
<p id="names" style="text-align:center;"></p>
<svg id="svg">
</svg>
<!-- <svg id="svgother"> </svg> -->
</body>
</html>
