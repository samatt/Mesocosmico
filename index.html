<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Mesocosmico Recipe Maker</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	
	<script>
		categories = {}

		$( document ).ready(function(){
			$("#categories").change(function(){
				var selectedCategory = $("#categories option:selected").val();
				displayRandomProduct(selectedCategory);
				// console.log(product);
			})
		});
		
		function getRandomInt(min, max) {
		  return Math.floor(Math.random() * (max - min)) + min;
		}

		function getRandItem(currentCategory){

			if(Object.keys(categories).length > 0){
				var randIndex = getRandomInt(0,categories[currentCategory].length);
				return categories[currentCategory][randIndex];
			}
		}

		function displayRandomProduct(currentCategory){
			var product = getRandItem(currentCategory);
			$("#selectedProduct").empty();
			$("#selectedProduct").append("<p> Product from selected category: </p>");
			$("#selectedProduct").append("<p><em>"+product+"</em></p>");

			$("#otherProducts").empty();
			var html="";
			html+= "<p> Other possible items </p>"
			for (cat in categories) {
				if(cat !== currentCategory){
					var otherProduct = getRandItem(cat);
					html+="<li><em>"+ otherProduct+"</em></li>";
				}
			};
			$("#otherProducts").append(html);
		}

		function loadOptions(data){
			// console.log(data);
			categories = data;
			var cats = Object.keys(data);
			$("#categories").empty();
			html ="";
			for (var i = 0; i < cats.length; i++) {
				if(i !== 0){
					html+= "<option value='" + cats[i] + "'>" + cats[i] + "</option>";
				}
			};
			$("#categories").append(html);

		}

		function getProducts(source, dest) {
			var request = $.ajax({
				type: "POST",
				url: "/test",
				data:JSON.stringify({"src":source,"dst":dest}),
				dataType: 'JSON',
				contentType: 'application/json' 
				})
				.done(function(data) {
					console.log( "success" );
					loadOptions(data);
				})
				.fail(function() {
					console.log( "error" );
				})
		}
		
		function findProducts(){
			var source = $("#source option:selected").val() 
			var dest = $("#destination option:selected").val()
			// console.log(source);
			// console.log(dest);
			getProducts(source,dest);
			
		}
	</script>
</head>

<body>
	<div id="header">
		<div id="view-tut">
			Mesocosmico Recipe Maker
		</div>
	</div>
	
	<div class="wrapper">
		<div id="main">
				<div id="view-tut">
					Source Country
				</div>
				<select id="source">
					<option value="chn">china</option>
					<option value="jpn">japan</option>
					<option value="fra">france</option>
					<option value="nld">netherlands</option>
					<option value="rus">russia</option>
					<option value="mex">mexico</option>
					<option value="ind">india</option>
					<option value="aus">australia</option>
					<option value="bra">brazil</option>
					<option value="tur">turkey</option>
					<option value="nga">nigeria</option>
					<option value="hkg">hong kong</option>
					<option value="isr">israel</option>
					<option value="ken">kenya</option>
					<option value="kor">south korea</option>
					<option value="prk">north korea</option>
				</select>
				<div id="view-tut">
					Destination Country
				</div>
				<select id="destination">
					<option value="chn">china</option>
					<option value="jpn">japan</option>
					<option value="fra">france</option>
					<option value="nld">netherlands</option>
					<option value="rus">russia</option>
					<option value="mex">mexico</option>
					<option value="ind">india</option>
					<option value="aus">australia</option>
					<option value="bra">brazil</option>
					<option value="tur">turkey</option>
					<option value="nga">nigeria</option>
					<option value="hkg">hong kong</option>
					<option value="isr">israel</option>
					<option value="ken">kenya</option>
					<option value="kor">south korea</option>
					<option value="prk">north korea</option>
				</select>
				<button type="button"onclick="findProducts()">Find Traded Products</button>
				<select id="categories">
				</select>
				<div id="selectedProduct">
				</div>

				<div id="otherProducts">
				</div>
			
		</div>
	</div>
	
</body>
</html>