<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Mesocosmico Recipe Maker</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
	<script>
		categories = {}

		$( document ).ready(function(){
			$("#categories").change(generateNew);
			$( ".products" ).hide();
		});
		
		function getRandomInt(min, max) {
		  return Math.floor(Math.random() * (max - min)) + min;
		}

		function getRandItem(currentCategory){

			if(Object.keys(categories).length > 0){
				var randIndex = getRandomInt(0,categories[currentCategory].length);
				return categories[currentCategory][randIndex];
			}
		}

		function displayRandomProduct(currentCategory){
			var product = getRandItem(currentCategory);
			$("#selectedProduct").empty();
			$("#selectedProduct").append("<p> Product from selected category: </p>");
			$("#selectedProduct").append("<p><em>"+product+"</em></p>");

			$("#otherProducts").empty();
			$("#otherCategory").empty();
			var html="";
			html+= "<p> Other possible items </p>"

			var htmlCat="";
			htmlCat+= "<p> From Category </p>"
			for (cat in categories) {
				if(cat !== currentCategory){
					var otherProduct = getRandItem(cat);
					html+="<li>"+ otherProduct+"</li>";
					htmlCat+= "<li>"+ cat+"</li>";
				}
			};
			$("#otherProducts").append(html);
			$("#otherCategory").append(htmlCat);


		}

		function generateNew(){
			var selectedCategory = $("#categories option:selected").val();
			displayRandomProduct(selectedCategory);
		}

		function loadOptions(data){
			// console.log(data);
			categories = data;
			var cats = Object.keys(data);
			$("#categories").empty();
			html ="";
			for (var i = 0; i < cats.length; i++) {
				if(i !== 0){
					html+= "<option value='" + cats[i] + "'>" + cats[i] + "</option>";
				}
			};
			$("#categories").append(html);

		}

		function getProducts(source, dest) {
			var request = $.ajax({
				type: "POST",
				url: "/test",
				data:JSON.stringify({"src":source,"dst":dest}),
				dataType: 'JSON',
				contentType: 'application/json' 
				})
				.done(function(data) {
					console.log( "success" );
					$( ".products" ).show();
					loadOptions(data);
				})
				.fail(function() {
					console.log( "error" );
				})
		}
		
		function findProducts(){
			var source = $("#source option:selected").val() 
			var dest = $("#destination option:selected").val()
			// console.log(source);
			// console.log(dest);
			$("#selectedProduct").empty();
			$("#otherProducts").empty();
			$("#otherCategory").empty();
			getProducts(source,dest);
			
		}
	</script>
</head>


<body>
	
	<form class="pure-form pure-form-stacked">
		<fieldset>
		 	<legend>Mesocosmico Recipe Maker</legend>
			<div class="pure-g">
			 	<div class="pure-u-1 pure-u-md-1-2">
	            	<label for="source">Source Country</label>
	            	<select id="source">
						<option value="chn">China</option>
						<option value="jpn">Japan</option>
						<option value="fra">France</option>
						<option value="nld">Netherlands</option>
						<option value="rus">Russia</option>
						<option value="mex">Mexico</option>
						<option value="ind">India</option>
						<option value="aus">Australia</option>
						<option value="bra">Brazil</option>
						<option value="tur">Turkey</option>
						<option value="nga">Nigeria</option>
						<option value="hkg">Hong Kong</option>
						<option value="isr">Israel</option>
						<option value="ken">Kenya</option>
						<option value="kor">South Korea</option>
						<option value="prk">North Korea</option>
					</select>
	        	</div>

	        	<div class="pure-u-1 pure-u-md-1-2">
	            	<label for="destination">Destination Country</label>
	            	<select id="destination" >
						<option value="chn">China</option>
						<option value="jpn">Japan</option>
						<option value="fra">France</option>
						<option value="nld">Netherlands</option>
						<option value="rus">Russia</option>
						<option value="mex">Mexico</option>
						<option value="ind">India</option>
						<option value="aus">Australia</option>
						<option value="bra">Brazil</option>
						<option value="tur">Turkey</option>
						<option value="nga">Nigeria</option>
						<option value="hkg">Hong Kong</option>
						<option value="isr">Israel</option>
						<option value="ken">Kenya</option>
						<option value="kor">South Korea</option>
						<option value="prk">North Korea</option>
					</select>
	        	</div>
	        </div>
	        	<button type="button" onclick="findProducts()" class="pure-button pure-button-primary pure-u-1-6">Get Product Categories</button>
	        	

	        	<div class="pure-u-1 pure-u-md-1-2 products">
	        	    <label for="categories">Product Categories</label>
					<select id="categories">
					</select>
	        	</div>
				
				<button type="button" onclick="generateNew()" class="pure-button pure-button-primary pure-u-1-8 products">Generate</button>
	        	<div class="pure-g">
	        	<div class="pure-u-1-3 pure-u-md-1-3">
	        		<div id="selectedProduct">
					</div>
        		</div>

        		<div class="pure-u-1-3 pure-u-md-1-3 products">
        			<div id="otherProducts">
        			</div>
        		</div>

        		<div class="pure-u-1-3 pure-u-md-1-3 products">
        			<div id="otherCategory">
        			</div>
        		</div>
        	</div>
        	 
		</fieldset>
	</form>
	
</body>
</html>