<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Mesocosmico Recipe Maker</title>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
	<script>
		categories = {}

		$( document ).ready(function(){
			$("#categories").change(getCategoryProducts);
			$(".products").hide();
			$(".tableHead").hide();
		});
		
		function getRandomInt(min, max) {
		  return Math.floor(Math.random() * (max - min)) + min;
		}

		function getRandItem(currentCategory){

			if(Object.keys(categories).length > 0){
				var randIndex = getRandomInt(0,categories[currentCategory].length);
				return categories[currentCategory][randIndex];
			}
		}

		function displayProducts(currentCategory){
			$("#selectedProduct").empty();
			var html = "";
			var catProducts = categories[currentCategory];
			for (var i =0 ; i< catProducts.length; i++) {				
				html+="<option>"+ catProducts[i]+"</option>";
			};
			$("#selectedProduct").append(html);
		}

		function populateTable(currentCategory){
			$("#productTable").empty();
			var html="";

			for (cat in categories) {
				if(cat !== currentCategory){
					html+="<tr>";
					var otherProduct = getRandItem(cat);
					html+="<td>"+cat+"</td>";
					html+="<td>"+otherProduct+"</td>";
					html+="<td>"+categories[cat].join(" , ")+"</td>";
					html+="</tr>";
				}
			};

			$("#productTable").append(html);

		}

		function displayRandomProduct(currentCategory){
			$("#otherProducts").empty();
			$("#otherCategory").empty();
			var html="";
			html+= "<p> Other possible items </p>"

			var htmlCat="";
			htmlCat+= "<p> From Category </p>"
			for (cat in categories) {
				if(cat !== currentCategory){
					var otherProduct = getRandItem(cat);
					html+="<li>"+ otherProduct+"</li>";
					htmlCat+= "<li>"+ cat+"</li>";
				}
			};
			$("#otherProducts").append(html);
			$("#otherCategory").append(htmlCat);


		}

		function getCategoryProducts(){
			var selectedCategory = $("#categories option:selected").val();
			displayProducts(selectedCategory);
		}

		function generateNew(){
			var selectedCategory = $("#categories option:selected").val();
			$(".tableHead").show();
			populateTable(selectedCategory);
		}

		function loadOptions(data){
			categories = data;
			var cats = Object.keys(data);
			$("#categories").empty();
			html ="";
			for (var i = 0; i < cats.length; i++) {
				if(i !== 0){
					html+= "<option value='" + cats[i] + "'>" + cats[i] + "</option>";
				}
			};
			$("#categories").append(html);
			$("select#categories").attr('selectedIndex', 0);
			getCategoryProducts();
		}

		function getProducts(source, dest) {
			var request = $.ajax({
				type: "POST",
				url: "/test",
				data:JSON.stringify({"src":source,"dst":dest}),
				dataType: 'JSON',
				contentType: 'application/json' 
				})
				.done(function(data) {
					console.log( "success" );
					$( ".products" ).show();
					loadOptions(data);

				})
				.fail(function() {
					console.log( "error" );
				})
		}
		
		function findProducts(){
			var source = $("#source option:selected").val() 
			var dest = $("#destination option:selected").val()
			$("#selectedProduct").empty();
			$("#otherProducts").empty();
			$("#otherCategory").empty();
			$("#productTable").empty();
			$(".products").hide();
			$(".tableHead").hide();
			getProducts(source,dest);
			
		}
	</script>
</head>


<body>
	
	<form class="pure-form pure-form-stacked">
		<fieldset>
		 	<legend>Mesocosmico Recipe Maker</legend>
			<div class="pure-g">
			 	<div class="pure-u-1 pure-u-md-1-2">
	            	<label for="source">Source Country</label>
	            	<select id="source">
						<option value="chn">China</option>
						<option value="jpn">Japan</option>
						<option value="fra">France</option>
						<option value="nld">Netherlands</option>
						<option value="rus">Russia</option>
						<option value="mex">Mexico</option>
						<option value="ind">India</option>
						<option value="aus">Australia</option>
						<option value="bra">Brazil</option>
						<option value="tur">Turkey</option>
						<option value="nga">Nigeria</option>
						<option value="hkg">Hong Kong</option>
						<option value="isr">Israel</option>
						<option value="ken">Kenya</option>
						<option value="kor">South Korea</option>
						<option value="prk">North Korea</option>
					</select>
	        	</div>

	        	<div class="pure-u-1 pure-u-md-1-2">
	            	<label for="destination">Destination Country</label>
	            	<select id="destination" >
						<option value="chn">China</option>
						<option value="jpn">Japan</option>
						<option value="fra">France</option>
						<option value="nld">Netherlands</option>
						<option value="rus">Russia</option>
						<option value="mex">Mexico</option>
						<option value="ind">India</option>
						<option value="aus">Australia</option>
						<option value="bra">Brazil</option>
						<option value="tur">Turkey</option>
						<option value="nga">Nigeria</option>
						<option value="hkg">Hong Kong</option>
						<option value="isr">Israel</option>
						<option value="ken">Kenya</option>
						<option value="kor">South Korea</option>
						<option value="prk">North Korea</option>
					</select>
	        	</div>
	        </div>
	        	<button type="button" onclick="findProducts()" class="pure-button pure-button-primary pure-u-1-6">Get Product Categories</button>
	        	

	        	<div class="pure-u-1 pure-u-md-1-2 products">
	        	    <label for="categories">Product Categories</label>
					<select id="categories">
					</select>
	        	</div>
				<div class="pure-u-1-3 pure-u-md-1-3 products">

					<label for="categories">Products</label>
					<select id="selectedProduct" >
					</select>
        		</div>
        		<div class="pure-g">
				<button type="button" onclick="generateNew()" class="pure-button pure-button-primary pure-u-1-8 products">Generate</button>
	        	</div>
				<table class="pure-table pure-table-bordered tableHead">
					<thead>
						<tr>
							<th>Category</th>
							<th>Randomly Selected Companion</th>
							<th>All Possible Companions</th>
						</tr>
					</thead>
					<tbody id="productTable">
					</tbody>
	        	</table>
		</fieldset>
	</form>
	
</body>
</html>